<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>API Timing Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/react@17/umd/react.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@17/umd/react-dom.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
  <div id="root" class="p-6"></div>

  <script type="text/babel">
    const App = () => {
      const [url, setUrl] = React.useState("");
      const [selector, setSelector] = React.useState("");
      const [browser, setBrowser] = React.useState("chrome");
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState("");
      const [results, setResults] = React.useState([]);

      const handleSubmit = async (e) => {
        e.preventDefault();
        setLoading(true);
        setError("");
        setResults([]);

        try {
          const response = await fetch("http://localhost:5000/capture", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              url,
              button_selector: selector,
              browser_type: browser
            })
          });

          const data = await response.json();

          if (data.error) {
            setError(data.error);
          } else {
            setResults(data.results || []);
          }
        } catch (err) {
          setError("Failed to connect to backend.");
        } finally {
          setLoading(false);
        }
      };

      return (
        <div className="max-w-3xl mx-auto bg-white p-6 rounded shadow">
          <h1 className="text-xl font-bold mb-4">API Tracer</h1>
          <form onSubmit={handleSubmit} className="space-y-4">
            <div>
              <label className="block text-sm">URL</label>
              <input
                type="text"
                value={url}
                onChange={(e) => setUrl(e.target.value)}
                className="w-full border px-3 py-2 rounded"
                placeholder="https://example.com"
                required
              />
            </div>
            <div>
              <label className="block text-sm">Button CSS Selector</label>
              <input
                type="text"
                value={selector}
                onChange={(e) => setSelector(e.target.value)}
                className="w-full border px-3 py-2 rounded"
                placeholder="#submitBtn"
                required
              />
            </div>
            <div>
              <label className="block text-sm">Browser</label>
              <select
                value={browser}
                onChange={(e) => setBrowser(e.target.value)}
                className="w-full border px-3 py-2 rounded"
              >
                <option value="chrome">Chrome</option>
                <option value="firefox">Firefox</option>
              </select>
            </div>
            <button
              type="submit"
              className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
              disabled={loading}
            >
              {loading ? "Capturing..." : "Capture"}
            </button>
          </form>

          {error && <p className="text-red-500 mt-4">{error}</p>}

          {results.length > 0 && (
            <div className="mt-6">
              <h2 className="text-lg font-semibold mb-2">Results</h2>
              <table className="w-full border-collapse">
                <thead>
                  <tr className="bg-gray-200">
                    <th className="border p-2">URL</th>
                    <th className="border p-2">Total Time (ms)</th>
                    <th className="border p-2">Wait Time (ms)</th>
                    <th className="border p-2">Receive Time (ms)</th>
                  </tr>
                </thead>
                <tbody>
                  {results.map((r, i) => (
                    <tr key={i} className="hover:bg-gray-50">
                      <td className="border p-2">{r.url}</td>
                      <td className="border p-2">{r.total_time.toFixed(2)}</td>
                      <td className="border p-2">{r.wait_time.toFixed(2)}</td>
                      <td className="border p-2">{r.receive_time.toFixed(2)}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          )}
        </div>
      );
    };

    ReactDOM.render(<App />, document.getElementById("root"));
  </script>
</body>
</html>
